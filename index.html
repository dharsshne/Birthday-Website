<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Magical Birthday Wishes</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Dancing+Script&display=swap" rel="stylesheet">
<style>
:root {
    --deep-navy: #18153a;
    --purple: #4c3260;
    --violet: #6353a3;
    --mauve: #b86ca2;
    --pale-lavender: #e7c6e7;
    --dark-purple: #3a2450;
}
html, body {
  width: 100vw;
  max-width: 100vw;
  overflow-x: hidden;
}
body {
  margin: 0;
  font-family: 'Playfair Display', serif;
  color: var(--pale-lavender);
  text-align: center;
  min-height: 100vh;
  background: url('images/back2.jpeg') center center/cover no-repeat fixed,
              linear-gradient(135deg, var(--deep-navy) 0%, var(--purple) 40%, var(--violet) 70%, var(--mauve) 90%, var(--pale-lavender) 100%);
  position: relative;
}
body::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  pointer-events: none;
  z-index: 0;
  background: radial-gradient(circle at 60% 30%, var(--pale-lavender) 0%, transparent 60%),
              radial-gradient(circle at 20% 80%, var(--mauve) 0%, transparent 70%);
  opacity: 0.5;
}
.page {
  display: none;
  padding: 20px;
  min-height: 100vh;
  width: 100%;
  position: relative;
  background: rgba(255,255,255,0.05);
  box-sizing: border-box;
  box-shadow: 0 8px 32px 0 rgba(76,50,96,0.18);
  border-radius: 18px;
  margin: 0 auto;
  z-index: 1;
  overflow-x: hidden;
}
.page.active {
  display: block;
  animation: pageFlip 1s ease forwards;
}
@keyframes pageFlip {
  0% { transform: rotateY(90deg); opacity: 0; }
  100% { transform: rotateY(0deg); opacity: 1; }
}
.btn {
  padding: 12px 24px;
  margin: 10px;
  border: none;
  border-radius: 12px;
  font-family: 'Dancing Script', cursive;
  font-size: 1.3rem;
  cursor: pointer;
  background: linear-gradient(45deg, var(--violet), var(--mauve));
  color: var(--deep-navy);
  font-weight: bold;
  text-shadow: 0 1px 8px var(--pale-lavender);
  box-shadow: 0 4px 8px rgba(24,21,58,0.18);
  transition: transform 0.2s, box-shadow 0.2s;
}
.btn:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 16px rgba(24,21,58,0.28);
  background: linear-gradient(45deg, var(--mauve), var(--violet));
}
h1,h2 {
  font-family: 'Dancing Script', cursive;
  color: var(--pale-lavender);
  margin-top: 60px;
  text-shadow: 0 2px 12px var(--deep-navy), 0 1px 0 var(--mauve);
}
h1, h2 {
  margin-top: 60px;
}
p, label, .typewriter {
  color: var(--pale-lavender);
  text-shadow: 0 1px 8px var(--deep-navy);
}
input, textarea {
  padding: 10px;
  margin: 8px;
  border: 1px solid var(--violet);
  border-radius: 10px;
  width: 80%;
  font-family: 'Dancing Script', cursive;
  font-size: 1.2rem;
  background: var(--pale-lavender);
  color: var(--deep-navy);
}
.fairy-lights {
  display: flex;
  justify-content: center;
  margin: 10px 0;
}
.fairy-lights span {
  width: 8px;
  height: 8px;
  background: var(--mauve);
  border-radius: 50%;
  margin: 0 6px;
  animation: twinkle 1.5s infinite alternate;
}
@keyframes twinkle {
  from { opacity: 0.2; }
  to { opacity: 1; }
}
.typewriter {
  font-family: 'Dancing Script', cursive;
  font-size: 1.4rem;
  white-space: pre-wrap;
  display: inline-block;
  border-right: 2px solid var(--purple);
  animation: blink 0.8s infinite;
}
.typewriter span {
  opacity: 0;
  display: inline-block;
  animation: fadeInChar 0.05s forwards;
}
@keyframes fadeInChar {
  to { opacity: 1; }
}
@keyframes blink {
  50% { border-color: transparent; }
}
#polaroid-frame {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  justify-items: center;
  margin: 20px auto;
  width: 95%;
  max-width: 600px;
  box-sizing: border-box;
}
.polaroid {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 8px;
  border: 5px solid var(--mauve);
  border-radius: 12px;
  background: var(--pale-lavender);
  color: var(--deep-navy);
  box-shadow: 0 6px 16px rgba(24,21,58,0.18),
              0 0 20px rgba(184,108,162,0.18);
  transform: rotate(var(--rotation, 0deg));
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  max-width: 100%;
  box-sizing: border-box;
}
.polaroid img {
  max-width: 100%;
  max-height: 100%;
  border-radius: 8px;
  height: auto;
  object-fit: contain;
}
.polaroid:hover {
  transform: scale(1.05) rotate(var(--rotation, 0deg));
  box-shadow: 0 12px 24px rgba(24,21,58,0.28),
              0 0 35px rgba(184,108,162,0.28);
}
.message-box {
  max-width: 90%;
  margin: 20px auto;
  padding: 18px 22px;
  background: rgba(231,198,231,0.8);
  border: 3px solid var(--mauve);
  border-radius: 16px;
  font-family: 'Dancing Script', cursive;
  font-size: 1.2rem;
  color: var(--dark-purple);
  line-height: 1.6;
  text-align: center;
  box-shadow: 0 6px 18px rgba(24,21,58,0.18),
              0 0 20px rgba(184,108,162,0.18);
  position: relative;
  z-index: 2;
  box-sizing: border-box;
}
.message-box::before {
  content: "‚ú®";
  font-size: 1.5rem;
  position: absolute;
  top: -14px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--pale-lavender);
  padding: 0 6px;
  border-radius: 50%;
}
#messages-page .message-box,
#messages-page .message-box p,
#messages-page .message-box #message-text,
#messages-page .message-box #message-sender {
  color: #2a1740 !important;
}
.special-note-box {
  background: rgba(231,198,231,0.7);
  border: 2px solid var(--mauve);
  border-radius: 15px;
  padding: 20px;
  margin: 20px auto;
  max-width: 90%;
  text-align: center;
  box-shadow: 0 4px 15px rgba(24,21,58,0.18);
  font-family: 'Cursive', 'Segoe UI';
  font-size: 16px;
  color: var(--purple);
  box-sizing: border-box;
}
.special-note-box p#special-note-text {
  color: var(--deep-navy);
  font-weight: 500;
  text-shadow: 0 1px 6px var(--pale-lavender);
}
.candle-option {
  margin: 30px auto 10px auto;
  text-align: center;
}
.candle-svg {
  width: 40px;
  height: 80px;
  cursor: pointer;
  display: inline-block;
  vertical-align: middle;
}
.candle-flame {
  transition: opacity 0.4s;
  opacity: 0;
}
.candle-flame.lit {
  opacity: 1;
  animation: flameFlicker 1s infinite alternate;
}
@keyframes flameFlicker {
  0% { transform: scaleY(1) scaleX(1);}
  100% { transform: scaleY(1.2) scaleX(0.8);}
}
.candle-count {
  color: var(--violet);
  font-family: 'Dancing Script', cursive;
  font-size: 1.1rem;
  margin-top: 8px;
}
.cake-container {
  margin: 30px auto 10px auto;
  text-align: center;
}
.cake-svg {
  width: 180px;
  height: 120px;
  display: block;
  margin: 0 auto;
}
.cake-candle-flame {
  opacity: 1;
  animation: none !important;
  transition: none !important;
}
@media screen and (max-width: 480px) {
  .cake-svg { width: 120px; height: 80px; }
}
.page {
  background: none;
}
.page > * { position: relative; z-index: 1; }
/* Fairy Lights Row */
.fairy-lights-row {
  position: relative;
  width: 100%;
  max-width: 700px;
  margin: 0 auto 40px auto;
  height: 180px;
  z-index: 2;
  box-sizing: border-box;
}
.fairy-rope {
  position: absolute;
  top: 40px;
  left: 0;
  width: 100%;
  height: 0;
  border-top: 4px dashed var(--mauve);
  z-index: 1;
}
.hanging-photos {
  position: absolute;
  top: 45px;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-around;
  z-index: 2;
  box-sizing: border-box;
}
.hanging-polaroid {
  width: 90px;
  height: 110px;
  background: var(--pale-lavender);
  border: 3px solid var(--mauve);
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(24,21,58,0.18);
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  animation: swing 3s infinite ease-in-out alternate;
  transform-origin: top center;
  margin-top: 0;
  margin-bottom: 0;
  box-sizing: border-box;
}
.hanging-polaroid img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 7px;
  margin-top: 7px;
}
.hanging-string {
  width: 2px;
  height: 30px;
  background: var(--purple);
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 0;
  border-radius: 2px;
}
@keyframes swing {
  0% { transform: rotate(-7deg);}
  50% { transform: rotate(7deg);}
  100% { transform: rotate(-7deg);}
}
/* Floating Polaroids */
.floating-polaroids {
  position: absolute;
  left: 0; right: 0;
  top: 220px;
  width: 100%;
  pointer-events: none;
  z-index: 1;
  box-sizing: border-box;
}
.floating-polaroid {
  position: absolute;
  width: 80px;
  height: 90px;
  background: var(--pale-lavender);
  border: 2px solid var(--mauve);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(24,21,58,0.15);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.85;
  animation: floatUp 8s linear infinite;
  will-change: transform;
  box-sizing: border-box;
}
.floating-polaroid img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 6px;
}
@keyframes floatUp {
  0% {
    transform: translateY(0) rotate(-10deg) scale(1);
    opacity: 0.8;
  }
  50% {
    transform: translateY(-80px) rotate(10deg) scale(1.07);
    opacity: 1;
  }
  100% {
    transform: translateY(-180px) rotate(-8deg) scale(1);
    opacity: 0;
  }
}
#thanks-page {
  color: #2a1740;
}
#thanks-page h2,
#thanks-page p,
#thanks-page .candle-count,
#thanks-page .candle-option {
  color: #2a1740 !important;
}
/* Sparkles */
.sparkle {
  width: 6px;
  height: 6px;
  background: linear-gradient(var(--pale-lavender), var(--mauve));
  border-radius: 50%;
  animation: sparkleTwinkle 1.5s infinite alternate;
  position: absolute;
  z-index: 10;
}
@keyframes sparkleTwinkle {
  0% { opacity: 0; transform: scale(0.3);}
  50% { opacity: 1; transform: scale(1);}
  100% { opacity: 0; transform: scale(0.3);}
}
/* Fun Fact Sparkle */
.funfact-sparkle {
  position: absolute;
  width: 32px;
  height: 32px;
  background: radial-gradient(circle at 60% 40%, #b86ca2 60%, #6353a3 100%);
  border-radius: 50%;
  box-shadow: 0 0 18px #b86ca2, 0 0 8px #6353a3;
  cursor: pointer;
  animation: funfactFloat 6s infinite alternate;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
  transition: transform 0.2s;
}
.funfact-sparkle:hover {
  transform: scale(1.2);
  box-shadow: 0 0 32px #b86ca2, 0 0 16px #6353a3;
}
@keyframes funfactFloat {
  0% { transform: translateY(0);}
  100% { transform: translateY(-30px);}
}
.funfact-popup {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
  background: #fff;
  color: #2a1740;
  border-radius: 18px;
  box-shadow: 0 4px 24px #6353a3;
  padding: 24px 32px;
  font-family: 'Dancing Script', cursive;
  font-size: 1.3rem;
  z-index: 9999;
  min-width: 220px;
  max-width: 80vw;
  display: none;
}
.funfact-popup.active {
  display: block;
  animation: fadeIn 0.5s;
}
@keyframes fadeIn {
  from { opacity: 0;}
  to { opacity: 1;}
}

/* Responsive adjustments for mobile screens */
@media screen and (max-width: 600px) {
  .page {
    padding: 8px;
    min-height: 100vh;
    width: 100vw;
    border-radius: 0;
    box-shadow: none;
  }
  #polaroid-frame {
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    width: 98vw;
    max-width: 98vw;
    margin: 10px auto;
  }
  .polaroid {
    padding: 4px;
    border-width: 3px;
    max-width: 98vw;
  }
  .polaroid img {
    max-width: 90vw;
    max-height: 120px;
  }
  .fairy-lights-row {
    max-width: 98vw;
    height: 120px;
  }
  .hanging-polaroid {
    width: 60px;
    height: 70px;
  }
  .hanging-polaroid img {
    width: 50px;
    height: 50px;
    margin-top: 4px;
  }
  .floating-polaroid {
    width: 55px;
    height: 65px;
  }
  .floating-polaroid img {
    width: 45px;
    height: 45px;
  }
  .cake-svg {
    width: 120px;
    height: 80px;
  }
  #funfact-sparkles-container {
    min-height: 50px;
    height: 50px;
  }
}
</style>
</head>
<body>

<!-- ========== Welcome Page ========== -->
<div id="welcome-page" class="page active">
  <h1 style="margin-top:30px; font-size:2.5rem; color:var(--pale-lavender); text-shadow:0 2px 24px var(--deep-navy);">
    ‚ú® Welcome to the Birthday Celebration of Harshini ‚ú®
  </h1>
  <div class="fairy-lights" style="margin:30px 0;">
    <span></span><span></span><span></span><span></span><span></span>
  </div>
  <p style="font-size:1.3rem; color:var(--pale-lavender); margin-bottom:40px; text-shadow:0 1px 8px var(--deep-navy);">
    Step into a magical world of wishes, memories, and love.<br>
    Click below to begin your journey!
  </p>
  <div id="funfact-section" style="margin:40px 0 0 0;">
    <h2 style="color:#2a1740;font-family:'Dancing Script',cursive;font-size:1.4rem;">
      Wanna know some fun facts about Harshini? Click the sparkles!
    </h2>
    <div id="funfact-sparkles-container" style="position:relative;min-height:80px;height:80px;width:100%;margin:20px 0;"></div>
  </div>
  <button class="btn" id="start-btn">Begin</button>
  <div id="funfact-popup" class="funfact-popup"></div>
</div>

<!-- ========== Landing Page ========== -->
<div id="landing-page" class="page">
  <h1>üìñ Choose Your Path</h1>
  <button class="btn" id="people-btn">People of Harshini üëØ</button>
  <button class="btn" id="birthday-btn">Birthday Baby üéÇ</button>
</div>

<!-- ========== People Page ========== -->
<div id="people-page" class="page">
  <h2>üìî Lovingly Tale</h2>
  <form id="wish-form">
    <input id="sender-name" placeholder="Your Name" required><br>
    <textarea id="birthday-message" placeholder="Write your wishes here‚Ä¶" required></textarea><br>
    <button type="submit" class="btn">Send Wish</button>
  </form>
  <button class="btn" type="button" onclick="showPage('landing')">Back</button>
</div>

<!-- ========== Thank You Page ========== -->
<div id="thanks-page" class="page">
  <h2>Thanks for your wish ‚ù§</h2>
  <p>(Diary closes üíå)</p>
  <div class="candle-option">
    <div id="candleArea">
      <svg class="candle-svg" id="candleSVG" viewBox="0 0 40 80">
        <rect x="15" y="30" width="10" height="40" rx="5" fill="#e7c6e7" stroke="#b86ca2" stroke-width="2"/>
        <rect x="19" y="25" width="2" height="8" fill="#6353a3"/>
        <ellipse id="candleFlame" class="candle-flame" cx="20" cy="22" rx="5" ry="8" fill="gold" />
      </svg>
    </div>
    <div class="candle-count" id="candleCountText">Candles lighted: <span id="candleCount">0</span></div>
    <div style="color:#2a1740;font-size:1rem;margin-top:8px;">
      Light the candle to send your wish!
    </div>
    <button class="btn" onclick="showPage('landing')">Back Home</button>
  </div>
  <!-- Ask for fun fact after lighting the candle -->
  <div id="funfact-thanks-section" style="margin:30px 0;">
    <h3 style="color:#2a1740;font-family:'Dancing Script',cursive;font-size:1.2rem;">
      Do you know a fun fact about Harshini? Share it!
    </h3>
    <form id="funfact-thanks-form">
      <textarea id="funfact-thanks-message" placeholder="Share a fun fact about Harshini‚Ä¶" required style="width:80%;font-size:1.1rem;"></textarea><br>
      <button type="submit" class="btn">Share Fun Fact</button>
    </form>
  </div>
</div>
<!-- ========== Secret Key Page ========== -->
<div id="birthday-page" class="page">
  <h2>üîë Enter Secret Key</h2>
  <form id="secret-form">
    <input id="secret-key" placeholder="Secret Key"><br>
    <button type="submit" class="btn">Unlock üéÅ</button>
  </form>
  <button class="btn" type="button" onclick="showPage('landing')">Back</button>
</div>

<!-- ========== Celebration Page ========== -->
<div id="celebration-page" class="page">
  <h1>‚òÅ Happy Birthday Pichii üíñ ‚òÅ</h1>
  <div class="fairy-lights-row">
    <div class="fairy-rope"></div>
    <div class="hanging-photos">
      <!-- Hanging polaroids will be injected here -->
    </div>
  </div>
  <div class="cake-container">
    <svg class="cake-svg" viewBox="0 0 180 120">
      <ellipse cx="90" cy="100" rx="70" ry="18" fill="#e7c6e7" stroke="#b86ca2" stroke-width="3"/>
      <rect x="20" y="50" width="140" height="50" rx="20" fill="#b86ca2" stroke="#6353a3" stroke-width="3"/>
      <ellipse cx="90" cy="50" rx="70" ry="18" fill="#e7c6e7" stroke="#b86ca2" stroke-width="3"/>
      <g id="cakeCandles"></g>
    </svg>
    <div style="color:#2a1740;font-family:'Dancing Script',cursive;font-size:1.1rem;margin-top:8px;">
      All your wishes are lighting up the cake!
    </div>
  </div>
  <div class="floating-polaroids">
    <!-- Floating polaroids will be injected here -->
  </div>
  <button class="btn" id="show-messages-btn">Here are some messages from your loved ones ‚ú®</button>
</div>

<!-- ========== Messages Page (storybook) ========== -->
<div id="messages-page" class="page">
  <h2>üìñ Wishes for Harshini</h2>
  <div id="polaroid-frame"></div>
  <div id="message-content">
    <div class="fairy-lights"><span></span><span></span><span></span><span></span><span></span></div>
    <div class="message-box" id="message-box">
      <p id="message-text"></p>
      <p id="message-sender" style="font-weight:bold; margin-top:10px;"></p>
    </div>
  </div>
  <button class="btn" id="prev-message-btn">Prev</button>
  <button class="btn" id="next-message-btn">Next</button>
  <button class="btn" id="final-btn" style="display:none;">One Last Message üíå</button>
</div>

<!-- ========== Special Note Page ========== -->
<div id="special-note-page" class="page">
  <h2>üí´ Special Note</h2>
  <div class="special-note-box" id="special-note-box">
    <p id="special-note-text"></p>
    <p id="special-note-sender" style="font-weight:bold; margin-top:10px;"></p>
    <h1>ONCE AGAIN <br>HAPPY BIRTHDAY PICHUU</h1>
  </div>
  <button class="btn" type="button" onclick="showPage('landing')">Back</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDvJF5VoOXOOPobZ1r78AIWE5NbM2dZeiM",
  authDomain: "harshini-s-birthday.firebaseapp.com",
  projectId: "harshini-s-birthday",
  storageBucket: "harshini-s-birthday.appspot.com",
  messagingSenderId: "40081991447",
  appId: "1:40081991447:web:3f80ed070f01abd7def952",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Hanging and Floating Polaroids for Celebration Page ---
const celebrationHangingPics = [
  'images/fro1.jpg','images/fro2.jpg','images/fro3.jpg','images/fro4.jpg','images/fro5.jpg'
];
const celebrationFloatingPics = [
  'images/ba1.jpg','images/ba3.jpg','images/ba5.jpg','images/ba4.jpg','images/ba2.jpg'
];

// Hanging Polaroids
const hangingPhotosDiv = document.querySelector('#celebration-page .hanging-photos');
hangingPhotosDiv.innerHTML = '';
celebrationHangingPics.forEach((src, i) => {
  const polaroid = document.createElement('div');
  polaroid.className = 'hanging-polaroid';
  polaroid.style.animationDelay = (i * 0.7) + 's';
  const string = document.createElement('div');
  string.className = 'hanging-string';
  polaroid.appendChild(string);
  const img = document.createElement('img');
  img.src = src;
  polaroid.appendChild(img);
  hangingPhotosDiv.appendChild(polaroid);
});

// Floating Polaroids
const floatingPolaroidsDiv = document.querySelector('#celebration-page .floating-polaroids');
floatingPolaroidsDiv.innerHTML = '';
celebrationFloatingPics.forEach((src, i) => {
  const polaroid = document.createElement('div');
  polaroid.className = 'floating-polaroid';
  polaroid.style.left = (10 + i*18) + '%';
  polaroid.style.animationDelay = (i * 2) + 's';
  const img = document.createElement('img');
  img.src = src;
  polaroid.appendChild(img);
  floatingPolaroidsDiv.appendChild(polaroid);
});

// üì∏ Polaroid Wall for People Page
const polaroidPics = [
  'images/pmc1.jpg','images/me1.jpg','images/surv.jpg', 'images/pmc2.jpg','images/subi1.jpg', 'images/pmc3.jpg','images/vid.jpg', 'images/pmc4.jpg', 'images/me2.jpg', 'images/jai.jpg', 'images/fam.jpg', 'images/subi2.jpg'
];

const polaroidFrame = document.getElementById('polaroid-frame');
polaroidPics.forEach(src => {
  const div = document.createElement('div');
  div.className = 'polaroid';
  div.style.setProperty('--rotation', (Math.random() * 10 - 5) + 'deg');
  const img = document.createElement('img');
  img.src = src;
  img.onload = () => {
    if (img.naturalWidth > img.naturalHeight) {
      img.style.maxWidth = "120px";
      img.style.maxHeight = "90px";
    } else {
      img.style.maxWidth = "90px";
      img.style.maxHeight = "120px";
    }
  };
  div.appendChild(img);
  polaroidFrame.appendChild(div);
});

// Candle logic: one candle per unique user (name)
function getUniqueUserCount(callback) {
  db.collection("wishes").get().then(snap => {
    const names = new Set();
    snap.docs.forEach(doc => {
      const data = doc.data();
      if (data.name) names.add(data.name.trim().toLowerCase());
    });
    callback(names.size);
  });
}
function updateCandleCountDisplay(count) {
  document.getElementById('candleCount').textContent = count;
}
function drawCakeCandles(count) {
  const cakeCandles = document.getElementById('cakeCandles');
  cakeCandles.innerHTML = '';
  if (count === 0) return;
  const startX = 35, endX = 145;
  for (let i = 0; i < count; i++) {
    const x = count === 1 ? 90 : startX + ((endX - startX) / (count - 1 || 1)) * i;
    cakeCandles.innerHTML += `
      <rect x="${x-3}" y="38" width="6" height="18" rx="3" fill="#e7c6e7" stroke="#6353a3" stroke-width="1"/>
      <rect x="${x-1}" y="34" width="2" height="8" fill="#6353a3"/>
      <ellipse class="cake-candle-flame" cx="${x}" cy="32" rx="3" ry="5" fill="gold"/>
    `;
  }
}
// Candle SVG click animation
const candleSVG = document.getElementById('candleSVG');
const candleFlame = document.getElementById('candleFlame');
if (candleSVG) {
  candleSVG.onclick = function() {
    if (!candleFlame.classList.contains('lit')) {
      candleFlame.classList.add('lit');
      setTimeout(() => {
        candleFlame.classList.remove('lit');
      }, 1800);
    }
  };
}

// Update candle count and cake candles on page load and when needed
function refreshCandlesEverywhere() {
  getUniqueUserCount(function(count) {
    updateCandleCountDisplay(count);
    drawCakeCandles(count);
  });
}
refreshCandlesEverywhere();

function resetCandleCount() {
  db.collection("wishes").get().then(() => {
    document.getElementById('candleCount').textContent = 0;
    drawCakeCandles(0);
  });
}

// Redraw candles when celebration page is shown
function showPage(pageId) {
  const current = document.querySelector('.page.active');
  if(current) {
    current.classList.add('turning');
    setTimeout(() => {
      current.classList.remove('active', 'turning');
      document.getElementById(pageId + "-page").classList.add('active');
      if (pageId === "celebration" || pageId === "thanks") refreshCandlesEverywhere();
      if (pageId === "thanks") resetCandleCount();
      if (pageId === "welcome") loadFunFacts();
    }, 500);
  } else {
    document.getElementById(pageId + "-page").classList.add('active');
    if (pageId === "celebration" || pageId === "thanks") refreshCandlesEverywhere();
    if (pageId === "thanks") resetCandleCount();
    if (pageId === "welcome") loadFunFacts();
  }
}

// Wish form: add wish and refresh candles
document.getElementById('wish-form').onsubmit = async (e) => {
  e.preventDefault();
  const name = document.getElementById('sender-name').value;
  const message = document.getElementById('birthday-message').value;
  await db.collection("wishes").add({ name, message });
  showPage("thanks");
  setTimeout(refreshCandlesEverywhere, 1000);
};

// Fun Fact form in Thank You page: add fun fact to Firestore (no name)
document.getElementById('funfact-thanks-form').onsubmit = async (e) => {
  e.preventDefault();
  const funfact = document.getElementById('funfact-thanks-message').value;
  await db.collection("funfacts").add({ funfact });
  document.getElementById('funfact-thanks-form').reset();
  alert("Fun fact shared! Go to the first page to see it sparkle!");
  loadFunFacts();
};

// Load fun facts and display as floating sparkles
function loadFunFacts() {
  db.collection("funfacts").get().then(snap => {
    const facts = snap.docs.map(doc => doc.data());
    const container = document.getElementById('funfact-sparkles-container');
    container.innerHTML = '';
    facts.forEach((fact, i) => {
      const sparkle = document.createElement('div');
      sparkle.className = 'funfact-sparkle';
      sparkle.style.left = (10 + Math.random()*80) + '%';
      sparkle.style.top = (10 + Math.random()*40) + 'px';
      sparkle.title = "Click for fun fact!";
      sparkle.innerHTML = "‚ú®";
      sparkle.onclick = function(e) {
        e.stopPropagation();
        showFunFactPopup(fact.funfact);
      };
      container.appendChild(sparkle);
    });
  });
}

// Show fun fact popup (no name)
function showFunFactPopup(fact) {
  const popup = document.getElementById('funfact-popup');
  popup.innerHTML = `<div style="margin-bottom:10px;">${fact}</div><br><button class="btn" onclick="closeFunFactPopup()">Close</button>`;
  popup.classList.add('active');
}
function closeFunFactPopup() {
  document.getElementById('funfact-popup').classList.remove('active');
}

// Messages logic
let wishes = [], currentIndex = 0;
document.getElementById('show-messages-btn').onclick = async () => {
  const snap = await db.collection("wishes").get();
  wishes = snap.docs.map(d => d.data());
  if(wishes.length) {
    currentIndex = 0;
    displayMessage();
    showPage("messages");
  } else alert("No wishes yet!");
};
function displayMessage() {
  const msg = wishes[currentIndex];
  document.getElementById('message-text').textContent = msg ? msg.message : "";
  document.getElementById('message-sender').textContent = msg ? `‚Äì ${msg.name}` : "";
  document.getElementById('final-btn').style.display = (currentIndex === wishes.length - 1) ? "block" : "none";
}
document.getElementById('prev-message-btn').onclick = () => {
  if(currentIndex > 0) { currentIndex--; displayMessage(); }
};
document.getElementById('next-message-btn').onclick = () => {
  if(currentIndex < wishes.length-1) { currentIndex++; displayMessage(); }
};
document.getElementById('final-btn').onclick = () => {
  showPage("special-note");
  typeWriterEffect(document.getElementById("special-note-text"), "Pichii üíï, The one who keeps the best version of me alive‚Ä¶ who always believes in me, supports me, and loves me no matter what. This little girl just hit 20!! üéâ stepping into adulthood. Crazy right? Feels unreal for me too. You honestly deserve all the happiness and peace this world can give. And you know what? This long distance‚Ä¶ it really hit me. Made me realize how incomplete I am without you. Showed me how damn strong our connection actually is. Maybe that‚Äôs why God planned this just to make our bond even stronger üí´. In a world full of people who treat me like an option, you‚Äôre the one who always made me feel valued, prioritized, and loved. You‚Äôre not just my person, you‚Äôre my family‚ù§Ô∏è.Life‚Äôs unpredictable anything can happen anytime. Even if someday I‚Äôm not around, I know my strong girl will handle everything bravely, smartly, and take care of herself. You‚Äôre gonna be that amazing doctor üë©‚Äç‚öïÔ∏è everyone looks up to. You‚Äôll reach great heights with or without me. I'll be cheering up for you wherever I am. Remember you should never ever doubt your worth and never drop your self-respect for anyone. Doesn‚Äôt matter how important they are nobody‚Äôs worth that. Keep your head up always, ‚Äòcause you‚Äôre too precious for this world ‚ú®. God will always give you best things at the right time, he knows what and when his girl needs something andI've made a special contract with him to give the best to my pichii and protect her. This note is just to remind you that you‚Äôre loved, more than you can ever imagine, by so many people. And me? I love you beyond everything‚Ä¶ forever and always üíñ. ", 50);
};
function typeWriterEffect(element, text, speed=50) {
  element.innerHTML = "";
  let i=0;
  function typing() {
    if(i < text.length) {
      const span = document.createElement('span');
      span.textContent = text.charAt(i);
      element.appendChild(span);
      i++;
      setTimeout(typing, speed);
    }
  }
  typing();
}
function createExtraSparkles() {
  setInterval(() => {
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.style.left = Math.random() * window.innerWidth + 'px';
    s.style.top = Math.random() * window.innerHeight + 'px';
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 2000);
  }, 400);
}

// Place this at the very end of your <script> tag, after ALL other code
createExtraSparkles();
loadFunFacts();

document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('start-btn').addEventListener('click', function() {
    showPage('landing');
  });
  document.getElementById('people-btn').addEventListener('click', function() {
    showPage('people');
  });
  document.getElementById('birthday-btn').addEventListener('click', function() {
    showPage('birthday');
  });
  document.getElementById('secret-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const key = document.getElementById('secret-key').value.trim();
    if(key === "Dr.Harshini") showPage("celebration");
    else alert("Wrong key!");
  });
});
</script>
</body>
</html>